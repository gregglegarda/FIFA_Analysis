---
title: "FIFA_Analysis"
author: "CrystalMeth"
date: "Nov 19, 2019"
output:
  html_document:
    number_sectiond: yes
    toc: yes
    toc_float:
      collapsed: no
  word_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = F)
options(scientific=T, digits = 3) 
```

```{r basicfcn, include=F}
# can add quietly=T option to the require() function
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
```
<<<<<<< HEAD
# Introduction

# FIFA Dataset 
=======
## Chapter 1: Introduction (Curtis)

## Chapter 2: Description of Data
>>>>>>> c62f819f41a0539212ee1fa7fe260fdac0397553

### 2.1 Source Data

In this study, the CSV data file comes from FIFA 2019 database (https://www.kaggle.com/karangadiya/fifa19). This dataset contains 18,207 soccer player information in FIFA 2019 with 89 variables such as name, age, nationality, skill level, potential, club, transferred value, wage, preferred foot, body type, position in the field, height, and weight.	

```{r source data, include=F}
library(readr)
fifa <- read_csv("fifa.csv")
str(fifa)

```

<<<<<<< HEAD
### Preparing and exploring the data (include =F)
```{r echo=FALSE, include= FALSE}

```

# Smart Question 1 (BIN)
## How can we predict a dream team by determining the optimal skills(strength, heading, kick, jump) and vcharacteristics( leftfooted, bodytype, vision)in certain positions? And who would be the best players for the position?
=======
### 2.2 Geographic Coverage of Data

To do a basic data visualization, latitude and longitude in the dataset are used to draw the map, which is plotted by leaflet library in R. 

#### The number of soccer players in each area of the world

```{r map1, include=F}
library(dplyr)
library(ggplot2)
library(maps)
overall_fifa <- fifa %>% 
  group_by(Nationality) %>% 
  summarise(Count = n(), 
            Avg_Overall = mean(Overall),
            Avg_Potential = mean(Potential),
            Avg_Pot_Diff = mean(Potential-Overall))
worldmap = map_data("world")
merged_fifa <- merge(x = worldmap, y = overall_fifa, by.x = "region", by.y = "Nationality", all.x = TRUE) %>% arrange(order)

```

```{r map1a, echo=F}
ggplot(data = merged_fifa, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = Count)) +
  labs(fill='Number of players')


```

#### The average skill level of soccer players in each area of the world (level: 0-100)

```{r map2, echo=F}
overall_fifa <- fifa %>% 
  group_by(Nationality) %>% 
  summarise(Count = n(), 
            Avg_Overall = mean(Overall),
            Avg_Potential = mean(Potential),
            Avg_Pot_Diff = mean(Potential-Overall)) %>%
  filter(Count > 45)
ggplot(data = merged_fifa, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = Avg_Overall)) +
  labs(fill='Average skill')


```


### Smart Question 1 (BIN)
#### How can we predict a dream team by determining the optimal skills(strength, heading, kick, jump) and vcharacteristics( leftfooted, bodytype, vision)in certain positions? And who would be the best players for the position?
>>>>>>> c62f819f41a0539212ee1fa7fe260fdac0397553

```{r S1, echo=FALSE, include=TRUE}
#TEST used: Classification (KNN, Decision trees)
```


```{r}
library(tidyverse)
library(ggplot2)

```


```{r}
fifa <- read.csv('data.csv')
```


```{r}
positions_names <- c("LS", "ST", "RS", "LW", "LF", "CF", "RF", "RW", "LAM", "CAM", "RAM", "LM", "LCM", "CM", "RCM", "RM", "LWB", "LDM", "CDM", "RDM", "RWB", "LB", "LCB", "CB", "RCB", "RB")
skills_names <- c("Crossing", "Finishing", "HeadingAccuracy", "ShortPassing", "Volleys", "Dribbling", "Curve", "FKAccuracy", "LongPassing", "BallControl", "Acceleration", "SprintSpeed", "Agility", "Reactions", "Balance", "ShotPower", "Jumping", "Stamina", "Strength", "LongShots", "Aggression", "Interceptions", "Positioning", "Vision", "Penalties", "Composure", "Marking", "StandingTackle", "SlidingTackle", "GKDiving", "GKHandling", "GKKicking", "GKPositioning", "GKReflexes")
```

```{r}
for (position in positions_names) {
  fifa[position] <- lapply(fifa[position], function(rating){
    as.integer(substr(rating, 0, 2))
  })
}
```


```{r}
fifa_players <- na.omit(fifa[c(positions_names, skills_names)])
```


```{r}
middle <- c("LAM", "CAM", "RAM", "LM", "LCM", "CM", "RCM", "RM", "LDM", "CDM", "RDM")
left <- c("LS", "LW", "LF", "LAM", "LM", "LCM", "LWB", "LDM", "LB", "LCB")
right <- c("RS", "RF", "RW", "RAM", "RCM", "RM", "RDM", "RWB", "RCB", "RB")
```


```{r}
middle_players <- fifa_players[c(middle, skills_names)]
left_players <- fifa_players[c(left, skills_names)]
right_players <- fifa_players[c(right, skills_names)]
```
```{r}
head(middle_players)

```

```{r}
middle_players$value <- (middle_players$LAM + middle_players$CAM + middle_players$RAM + middle_players$LM + middle_players$LCM + middle_players$CM + middle_players$RCM + middle_players$RM + middle_players$LDM + middle_players$CDM + middle_players$RDM)/11
middle_players$value <- round(middle_players$value)
head(middle_players)
```


```{r}
middle_players_skills <- middle_players[-c(1:11, 46)]
head(middle_players_skills)
```

```{r}
middle_players_skills_scale = data.frame(scale(middle_players_skills))
head(middle_players_skills_scale)
```




```{r}
mps.pr.out =prcomp(middle_players_skills_scale, scale =TRUE)
summary(mps.pr.out)
mps.pr.out$rotation
```

```{r}
biplot(mps.pr.out, scale = 0)
```


```{r}
plot(mps.pr.out, type="l")
```

```{r}
mps.pr.var <- (mps.pr.out$sdev^2)
mps.pve <- mps.pr.var/sum(mps.pr.var)
plot(cumsum(mps.pve), xlab="Principal Component (standardized)", ylab ="Cumulative Proportion of Variance Explained",ylim=c(0,1),type="b")
```



```{r}
head(middle_players_skills_scale)
```

```{r}
mps.pr.out$rotation
```

```{r}
mp.pca <- cbind(middle_players[46], data.frame(mps.pr.out$x))
head(mp.pca)
```

```{r}
mp.pcr1 <- lm(value ~., data = mp.pca)
summary(mp.pcr1)
```

```{r}
mp.pcr2 <- lm(value ~ PC1 + PC2 + PC3, data = mp.pca)
summary(mp.pcr2)
```

```{r}
anova(mp.pcr1, mp.pcr2)
```

# Smart Question 2 (RUSSELL)
## What variables contribute most to a player’s amount of penalties? How does Aggression, Composure affect the number of Penalties they receive 
```{r S2, echo=FALSE, include=TRUE}


```




# Smart Question 3 (CURTIS)
## What variables contribute the most to a goalkeeper’s potential? Age, physical factors, current gk skills, etc... 
```{r S3, echo=FALSE, include=TRUE}
#TEST used:  multivariate regression


```




# Smart Question 4 (GREGG)
## How do specific Skill Sets/ Characteristics affect a players wage? How about value? Can we say Skills are a good predictor of Wage and value?

```{r r, echo=FALSE, include=TRUE}
## reading data
data <- read.csv("data.csv", check.names = FALSE, stringsAsFactors = FALSE)
```

```{r S4, echo=FALSE, include=TRUE}

wage_skills <- c("Wage","Crossing", "Finishing", "HeadingAccuracy", "ShortPassing", "Volleys", "Dribbling", "Curve", "FKAccuracy", "LongPassing", "BallControl", "Acceleration", "SprintSpeed", "Agility", "Reactions", "Balance", "ShotPower", "Jumping", "Stamina", "Strength", "LongShots", "Aggression", "Interceptions", "Positioning", "Vision", "Penalties", "Composure", "Marking", "StandingTackle", "SlidingTackle", "GKDiving", "GKHandling", "GKKicking", "GKPositioning", "GKReflexes")

value_skills <- c("Value", "Crossing", "Finishing", "HeadingAccuracy", "ShortPassing", "Volleys", "Dribbling", "Curve", "FKAccuracy", "LongPassing", "BallControl", "Acceleration", "SprintSpeed", "Agility", "Reactions", "Balance", "ShotPower", "Jumping", "Stamina", "Strength", "LongShots", "Aggression", "Interceptions", "Positioning", "Vision", "Penalties", "Composure", "Marking", "StandingTackle", "SlidingTackle", "GKDiving", "GKHandling", "GKKicking", "GKPositioning", "GKReflexes")
```


### ***Clean Up Wage and Value Data
```{r S4a, echo=FALSE, include=TRUE}
####CLEAN DATA (Wage and Value having same range. remove M and K and period)

#clean data (Removing Pound Sign)
library('stringr')
data_wage_skills <- na.omit(data[c(wage_skills)])
data_value_skills <- na.omit(data[c(value_skills)])

data_wage_skills$Wage <- str_replace(
    data_wage_skills$Wage, # column we want to search
    pattern = '[€]', # what to find
    replacement = '' # what to replace it with
)
data_value_skills$Value <- str_replace(
    data_value_skills$Value, # column we want to search
    pattern = '[€]', # what to find
    replacement = '' # what to replace it with
)
```


***Cleaned up Wage Data
```{r S4b, echo=FALSE, include=TRUE}


####Start of Wage Cleanup

data_wage_skills$WageM <- str_replace(
    data_wage_skills$Wage, # column we want to search
    pattern = 'M', # what to find
    replacement = '' # what to replace it with
)
data_wage_skills$WageK <- str_replace(
    data_wage_skills$Wage, # column we want to search
    pattern = 'K', # what to find
    replacement = '' # what to replace it with
)

data_wage_skills$WageMM <- rep(0, length(data_wage_skills$WageM))
data_wage_skills$WageKK <- rep(0, length(data_wage_skills$WageK))

non_alphaM <-grep("[[:alpha:]]",data_wage_skills$WageM, invert = TRUE)
data_wage_skills$WageMM[non_alphaM] <- data_wage_skills$WageM[non_alphaM]

non_alphaK <-grep("[[:alpha:]]",data_wage_skills$WageK, invert = TRUE)
data_wage_skills$WageKK[non_alphaK] <- data_wage_skills$WageK[non_alphaK]

data_wage_skills$WageMM <- as.numeric(data_wage_skills$WageMM)*1000000
data_wage_skills$WageKK <- as.numeric(data_wage_skills$WageKK)*1000

data_wage_skills$Wage <- data_wage_skills$WageMM + data_wage_skills$WageKK

#summary(data_wage_skills$Wage)
#head(data_wage_skills)
#tail(data_wage_skills)
#summary(data_wage_skills)

#### End of Wage CLeanup
```


***Cleaned up Value Data
```{r S4c, echo=FALSE, include=TRUE}

#### Start of ValueCleanup

data_value_skills$ValueM <- str_replace(
    data_value_skills$Value, # column we want to search
    pattern = 'M', # what to find
    replacement = '' # what to replace it with
)
data_value_skills$ValueK <- str_replace(
    data_value_skills$Value, # column we want to search
    pattern = 'K', # what to find
    replacement = '' # what to replace it with
)

data_value_skills$ValueMM <- rep(0, length(data_value_skills$ValueM))
data_value_skills$ValueKK <- rep(0, length(data_value_skills$ValueK))

non_alphaVM <-grep("[[:alpha:]]",data_value_skills$ValueM, invert = TRUE)
data_value_skills$ValueMM[non_alphaVM] <- data_value_skills$ValueM[non_alphaVM]

non_alphaVK <-grep("[[:alpha:]]",data_value_skills$ValueK, invert = TRUE)
data_value_skills$ValueKK[non_alphaVK] <- data_value_skills$ValueK[non_alphaVK]

data_value_skills$ValueMM <- as.numeric(data_value_skills$ValueMM)*1000000
data_value_skills$ValueKK <- as.numeric(data_value_skills$ValueKK)*1000

data_value_skills$Value <- data_value_skills$ValueMM + data_value_skills$ValueKK

#summary(data_value_skills$Value)
#head(data_value_skills)
#tail(data_value_skills)
#summary(data_value_skills)

#### End of Value Cleanup
```



### Tests
```{r S4d, include=TRUE}

#TEST used: 
#Wage - do PCA/PCR to find out the attributes that explain it the most
#Value- do PCA/PCR to find out the attributes that explain it the most
#Skill/Characteristics - classify the most important attributes into skills and characteristics
#Make sure p values are good
#Use the model to predict. Use multvariable regression
# PCA wage_skills

data_wage_skills <- na.omit(data_wage_skills[c(wage_skills)])
data_value_skills <- na.omit(data_value_skills[c(value_skills)])

#head(data_wage_skills)
#tail(data_wage_skills)
#summary(data_wage_skills)
#head(data_value_skills)
#tail(data_value_skills)
#summary(data_value_skills)
```


### PCA Wage-Skills raw and centered
```{r S4e, echo=FALSE, include=TRUE}
PCA_wage_skills_C <- prcomp(data_wage_skills, center = TRUE,scale. = TRUE) #center
PCA_wage_skills_R <- prcomp(data_wage_skills, center = TRUE,scale. = FALSE) #raw
summary(PCA_wage_skills_C)
summary(PCA_wage_skills_R)
```


### PCA Value-Skills raw and centered
```{r S4f, echo=FALSE, include=TRUE}
PCA_value_skills_C <- prcomp(data_value_skills, center = TRUE,scale. = TRUE) #center
PCA_value_skills_R <- prcomp(data_value_skills, center = TRUE,scale. = FALSE) #raw
summary(PCA_value_skills_C)
summary(PCA_value_skills_R)
```



<<<<<<< HEAD
# Smart Question 5 (JAY)
## How do physical factors (age, preferred foot, overall skill, international reputation, position in the field, weight, and height) help the soccer professionals to get wage for higher 100,000 Euro per week?
```{r S5, echo=FALSE, include=TRUE}
#Wage(Factor) – 1 (Higher 100k euro per week), 0 (lower 100k euro per week).
#Age (Integer)
#Foot (Factor)
#Skill (Integer)
#Weight (Integer)
#Height (Integer)
#International reputation (Factor) – 5 level.
#Position (Factor) – 4 types, including Goalkeeper, defense, midfield, and attack.
=======
## Chapter 7: Earning higher 100,000 Euro per week of soccer players (Jay)

### 7.1 SMART Question
#### How do physical factors help the soccer professionals to get wage for higher 100,000 Euro per week?

```{r import fifa, include=F}
#import data
Dataa <- read.csv("fifa.csv")
fifaOri <- select(Dataa, Age, Overall, Wage, Preferred.Foot, Position, Height, Weight)

```

### 7.2 Exploratory Data Analysis
In this section, we perform the exloratory data analysis (EDA) on several numerical variables in the dataset. After assessing some of the characteristics of those variables, we decided to clean the data by omitting outliers and NA values. 

#### 7.2.1. Data tranformation and Descriptive Statistics
##### Data tranformation 
In this chapter, we use logistic regression with 7 variables including age, skill level, wage, preferred foot, position, height, and weight. However, we have not cleaned the data yet.

The original data are below:

```{r EDA, echo=F}
str(fifaOri)

```

```{r clean data, include=F}
#clean data
#wage
library(stringr)
numextract <- function(string){ 
  str_extract(string, "\\-*\\d+\\.*\\d*")
} 
fifaOri$Wage <- as.integer(numextract(fifaOri$Wage))
fifaOri$Wage_dummy <- as.factor(ifelse(fifaOri$Wage > 99, 1, 0))
#Foot - cleaned
y <- as.factor(fifaOri$Preferred.Foot)
levels(y) <- list(Left  = c("Left"), 
                  Right = c("Right"))
fifaOri <- mutate(fifaOri, Preferred.Foot = y)
#age - cleaned
#skill - cleaned
#Weight
fifaOri$Weight <- as.integer(numextract(fifaOri$Weight))
#Height 
library(gsubfn)
fifaOri$Height <- as.numeric(gsubfn("(\\d)'(\\d+)", ~ as.numeric(x) * 30.48 + 
            as.numeric(y) * 2.54, sub('"', '', fifaOri$Height)))
fifaOri$Height <- as.integer(fifaOri$Height)
#position
x <- as.factor(fifaOri$Position)
levels(x) <- list(GK  = c("GK"), 
                  DEF = c("LWB", "LB", "CB", "RB", "RWB", "LCB", "RCB"), 
                  MID = c("CM", "LDM", "LAM", "RDM", "RAM", "CDM", "CAM", "LM", "RM", "LCM", "RCM"), 
                  FWD = c("CF", "ST", "LW", "RW", "LF", "RF", "LS", "RS"))
fifaOri <- mutate(fifaOri, Position = x)
#Region 
#library(countrycode)
#fifa$Nationality <- as.factor(fifa$Nationality)
#fifa$region <- as.factor(countrycode(sourcevar = fifa[, "Nationality"],
                          #  origin = "country.name",
                           # destination = "continent"))
#fifa <- mutate(fifa, Position = x)

str(fifaOri)
head(fifaOri)


```

After transforming some variables, we got the new data. There are 4 numeric variables (age, skill level, height, and weight) and 3 categorical variables (Wage_dummy, position, and preferred foot)    

The new data are below:

```{r EDA1, echo=F}
fifaQQ <- select(fifaOri, Age, Overall, Height, Weight, Position, Preferred.Foot, Wage_dummy)
str(fifaQQ)

```

##### Descriptive Statistics

The descriptive statistics are presented below:

```{r EDA2, echo=F}
summary(fifaQQ)

```

According to the above statistics, it can be seen that mean and median of 4 numeric variables are very close. However, There are a lot of missing values (NAs) in height, weight, position, and preferred foot.

#### 7.2.2. Normality (Q-Q plots)

In this step, we need to check normality for 4 numeric variable, including age, skill level, height, and weight. 

```{r EDA3, echo=F}
par(mfrow=c(2,2))
qqnorm(fifaQQ$Age, main = "Age Q-Q plot", ylab="Age quantiles")
qqline(fifaQQ$Age, col = "red")
qqnorm(fifaQQ$Overall, main = "Skill level Q-Q plot", ylab="Skill level quantiles")
qqline(fifaQQ$Overall, col = "red")
qqnorm(fifaQQ$Height, main = "Height Q-Q plot", ylab="Height quantiles")
qqline(fifaQQ$Height, col = "red")
qqnorm(fifaQQ$Weight, main = "Weight Q-Q plot", ylab="Weight quantiles")
qqline(fifaQQ$Weight, col = "red")

```

According to the above Q-Q plots, these four numeric variables are not far from normal distribution. However, the tails in each Q-Q plot indicate that the data have the outliers. Therefore, removing outliers process is required before doing an analysis in the next step.

```{r out, include=F}
#Create a function to eliminate outliners.
outlierKD <- function(dt, var, rmv=NULL) { 
     var_name <- eval(substitute(var),eval(dt))
     na1 <- sum(is.na(var_name))
     m1 <- mean(var_name, na.rm = T)
     sd1 <- sd(var_name,na.rm = T)
     par(mfrow=c(2, 2), oma=c(0,0,3,0))
     boxplot(var_name, main="With outliers")
     hist(var_name, main="With outliers", xlab=NA, ylab=NA)
     outlier <- boxplot.stats(var_name)$out
     mo <- mean(outlier)
     var_name <- ifelse(var_name %in% outlier, NA, var_name)
     boxplot(var_name, main="Without outliers")
     hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
     title("Outlier Check", outer=TRUE)
     na2 <- sum(is.na(var_name))
     cat("Outliers identified:", na2 - na1, "n")
     cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "n")
     cat("Mean of the outliers:", round(mo, 2), "n")
     m2 <- mean(var_name, na.rm = T)
     cat("Mean without removing outliers:", round(m1, 2), "n")
     cat("Mean if we remove outliers:", round(m2, 2), "n")
     #
     if(is.null(rmv)) { 
       response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ") 
     } else {
       if (rmv=='y'|rmv=='yes'|rmv=='Y'|rmv=='Yes'|rmv=='YES'|rmv==TRUE ) { response = 'y' } else { response = 'n' }
     }
     #
     if(response == "y" | response == "yes"){
          dt[as.character(substitute(var))] <- invisible(var_name)
          assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
          cat("Outliers successfully removed", "n")
          return(invisible(dt))
     } else{
          cat("Nothing changed", "n")
          return(invisible(var_name))
     }
}
```

```{r out2, include=F}
outlierKD(fifaQQ, Age,'y') #Eliminate outliers.
outlierKD(fifaQQ, Overall,'y') #Eliminate outliers.
outlierKD(fifaQQ, Weight,'y') #Eliminate outliers.
outlierKD(fifaQQ, Height,'y') #Eliminate outliers.
fifaNew <- na.omit(fifaQQ) #Eliminate NAs
summary(fifaNew) #Check the summary statistics of fifa
str(fifaNew)

```

### 7.3 Pre-Logistic Regression

#### Does the data support that “Age”, "Preferred foot", "Overall skill level", "Preferred position", "Weight", and "Height" affect “Wage”?

#### 7.3.1 Age VS Wage

To study the effects on wage by the age (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.1, include=F}
wageagetable = xtabs(~ Wage_dummy + Age, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.1a, echo=F}
chisqres_Q1 = chisq.test(wageagetable)
chisqres_Q1

```

From the small p-value of `r chisqres_Q1$p.value`, we reject the null hypothesis that the "Wage" and  "Age" are independent. Therefore, the data supports “age” may have an effect on “Wage”. 

#### 7.3.2 Preferred foot VS Wage

To study the effects on wage by preferred foot (both of them categorical variables), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.2, include=F}
wagefoottable = xtabs(~ Wage_dummy + Preferred.Foot, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.2a, echo=F}
chisqres_Q2 = chisq.test(wagefoottable)
chisqres_Q2

```

From the large p-value of `r chisqres_Q2$p.value`, we fall to reject the null hypothesis that the "Wage" and  "Foot" are independent. Therefore, the data supports “Prefered foot” might not have an effect on “Wage”. 

##### 7.3.3 Wage VS Overall skill level

To study the effects on wage by the skill level (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.3, include=F}
wageskilltable = xtabs(~ Wage_dummy + Overall, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.3a, echo=F}
chisqres_Q3 = chisq.test(wageskilltable)
chisqres_Q3

```

From the small p-value of `r chisqres_Q3$p.value`, we reject the null hypothesis that the "Wage" and  "Skill level" are independent. Therefore, the data supports “Skill level” might have an effect on “Wage”.

##### 7.3.4 Wage VS Height

To study the effects on wage by the height (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.  

```{r 4.3.4, include=F}
wageheitable = xtabs(~ Wage_dummy + Height, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.4a, echo=F}
chisqres_Q4 = chisq.test(wageheitable)
chisqres_Q4

```

From the large p-value of `r chisqres_Q4$p.value`, we fall to reject the null hypothesis that the "Wage" and  "Height" are independent. Therefore, the data supports “Height” might not have an effect on “Wage”.


#### 7.3.5 Wage VS Weight

To study the effects on wage by the weight (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.  

```{r 4.3.5, include=F}
wageweitable = xtabs(~ Wage_dummy + Weight, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.5a, echo=F}
chisqres_Q5 = chisq.test(wageweitable)
chisqres_Q5

```

From the large p-value of `r chisqres_Q5$p.value`, we fall to reject the null hypothesis that the "Wage" and  "weight" are independent. Therefore, the data supports “Weight” might not have an effect on “Wage”.

#### 7.3.6 Wage VS Perferred position in the field

To study the effects on wage by the position (two categorical variables), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.6, include=F}
wagepositable = xtabs(~ Wage_dummy + Position, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.6a, echo=F}
chisqres_Q6 = chisq.test(wagepositable)
chisqres_Q6
>>>>>>> c62f819f41a0539212ee1fa7fe260fdac0397553

```

From the small p-value of `r chisqres_Q6$p.value`, we reject the null hypothesis that the "Wage" and  "Position" are independent at the 1% significance level. Therefore, the data supports “Position” might have an effect on “Wage”.

### 7.4 Logistic Regression

Let us now turn our attention to logistic regression models. We run the Wage model including age, preferred.Foot, overall skill level, preferred position in the field, weight, and height.

```{r 4.4, include=F}
wageLogit <- glm(Wage_dummy ~ Age + Preferred.Foot + Overall + Position + Weight + Height , data = fifaNew, family = "binomial")

```

#### We can see the summary of the logistic regression model here:  
```{r 4.4a, echo=F}
summary(wageLogit)
```
#### Model interpretation: 

##### The age effect on wage
According to the above regression results, the cofficient on age indicates that for every one year increases in age, ln(odds-ratio) of wage at higher 100,000 Euro per week level decreases by 0.06. In other word, it means that the young player have more opportunity to earn higher 100k Euro per week than the olders. Furthermore, it is statistically significant.

##### The preferred foot effect on wage
For preferred foot: use left foot as baseline, ln(odds-ratio) of wage at higher 100,000 Euro per week level deceases by 0.02 when changing from left to right foot. So, it is likely that the left foot players have more the opportunity to earn higher 100,000 Euro per week than the right foot player. However, it is not statistically significant. 

##### The skill level effect on wage
The cofficient on skill level indicates that for every one level increases in overall skill, ln(odds-ratio) of wage at higher 100,000 Euro per week level increase by 0.72. In other word, it means that the high skill players have more opportunity to earn higher 100k Euro per week than the low skill players. In addition, it is statistically significant.

##### The effect of position of the player in the field on wage 
For position: use Goalkeeper as baseline, ln(odds-ratio) of wage at higher 100,000 Euro per week level increases by 1.42 when changing from Goalkeeper to Defender. And, ln(odds-ratio) of higher 100,000 euro wage increases by 1.35 when changing from Goalkeeper to Midfielder. Finally, ln(odds-ratio) of higher 100,000 euro wage increases by 1.49 when changing from Goalkeeper to Forward. It is likely that the opportunity to earn higher 100k Euro per week will increase if the preferred position of soccer players are far from goalkeeper. In addition, the case is statistically significant. 

##### The weight effect on wage
The cofficient on weight indicates that for every one lbs increases in weight, ln(odds-ratio) of wage at higher 100,000 Euro per week level decreases by 0.006. In other word, it means that the low weight players have more opportunity to earn higher 100k Euro per week than the high weight players. However, this case is not statistically significant.

##### The height effect on wage
The cofficient on height indicates that for every one centimeter (CM) increases in height, ln(odds-ratio) of wage at higher 100,000 Euro per week level decreases by 0.002. In other word, it seems that the short players have more opportunity to earn higher 100k Euro per week than the tall players height. However, it is not statistically significant.

### 7.5 Model evaluation

#### 7.5.1. ROC curve and AUC
Receiver-Operator-Characteristic (ROC) curve and Area-Under-Curve (AUC) measures the true positive rate (or sensitivity) against the false positive rate (or specificity). The area-under-curve is always between 0.5 and 1. Values higher than 0.8 is considered good model fit.  

```{r 4.5.1, include=F}
library(pROC) # receiver operating characteristic curve, gives the diagnostic ability of a binary classifier system as its discrimination threshold is varied. The curve is on sensitivity/recall/true-positive-rate vs false_alarm/false-positive-rate/fall-out.
prob=predict(wageLogit, type = c("response"))
fifaNew$prob=prob
h <- roc(Wage_dummy~prob, data=fifaNew)
auc(h) # area-under-curve prefer 0.8 or higher.

```

The result is shown here: 

```{r 4.5.1a, echo=F}
plot(h)
# detach("package:pROC", unload = T) # good habit to remove unload packages no longer needed 
```

We have here the area-under-curve of `r auc(h)`, which is higher than 0.8. This indicates the model is really a good fit, and all the coefficients are significant.  

#### 7.5.2. McFadden  
McFadden is another evaluation tool we can use on logitistic regressions. This is part of what is called pseudo-R-squared values for evaluation tests.

```{r 4.5.2, include=F}
library(pscl) # use pR2( ) function to calculate McFadden statistics for model eval
wageLogitpr2 = pR2(wageLogit)
wageLogitpr2
# detach("package:pscl", unload = T) # good habit to remove unload packages no longer needed 
```

In this case, the McFadden value is `r wageLogitpr2['McFadden']`, which is analgous to the coefficient of determination R$2$, only about 5.7% of the variations in y is explained by the explanatory variables in the model. 

