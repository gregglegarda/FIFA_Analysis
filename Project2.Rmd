---
title: "FIFA_Analysis"
author: "CrystalMeth"
date: "Nov 19, 2019"
output:
  html_document:
    number_sectiond: yes
    toc: yes
    toc_float:
      collapsed: no
  word_document:
    toc: yes
---
```{r outlierKD_def, include=FALSE}
# modified to allow prompt-free run-through
outlierKD <- function(dt, var, rmv=NULL) { 
     var_name <- eval(substitute(var),eval(dt))
     na1 <- sum(is.na(var_name))
     m1 <- mean(var_name, na.rm = T)
     sd1 <- sd(var_name,na.rm = T)
     par(mfrow=c(2, 2), oma=c(0,0,3,0))
     boxplot(var_name, main="With outliers")
     hist(var_name, main="With outliers", xlab=NA, ylab=NA)
     outlier <- boxplot.stats(var_name)$out
     mo <- mean(outlier)
     var_name <- ifelse(var_name %in% outlier, NA, var_name)
     boxplot(var_name, main="Without outliers")
     hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
     title("Price", outer=TRUE)
     na2 <- sum(is.na(var_name))
     cat("Outliers identified:", na2 - na1, "n")
     cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "n")
     cat("Mean of the outliers:", round(mo, 2), "n")
     m2 <- mean(var_name, na.rm = T)
     cat("Mean without removing outliers:", round(m1, 2), "n")
     cat("Mean if we remove outliers:", round(m2, 2), "n")
     #
     if(is.null(rmv)) { 
       response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ") 
     } else {
       if (rmv=='y'|rmv=='yes'|rmv=='Y'|rmv=='Yes'|rmv=='YES'|rmv==TRUE ) { response = 'y' } else { response = 'n' }
     }
     #
     if(response == "y" | response == "yes"){
          dt[as.character(substitute(var))] <- invisible(var_name)
          assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
          cat("Outliers successfully removed", "n")
          return(invisible(dt))
     } else{
          cat("Nothing changed", "n")
          return(invisible(var_name))
     }
}
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(include = F)
options(scientific=T, digits = 3) 
```

```{r basicfcn, include=F}
# can add quietly=T option to the require() function
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
loadPkg("car")
loadPkg("pls")
loadPkg("corrplot")
```

## Introduction

## FIFA Dataset 

## Chapter 1: Introduction
FIFA 19 is a football (soccer) simulation video game developed by EAsports. It is a part of the FIFA series, which has been produced for over 20 years. Every year, a FIFA game is released, FIFA 2019 was released in 2018, at the beginning of the 2018-2019 season of major soccer leagues in Europe. FIFA 2019 has over 31 leagues and more than 720 playable teams from around the world. This game contains an enormous amount of data which demonstrates different ratings and information of players, ranging from age and nationality to skillsets such as finishing, kicking, heading, tackling and even weak-foot strength. 

How do they complete such a huge database of ratings for every single player from all the licensed leagues? EA Sports employs a team of 25 EA Producers and 400 outside data contributors, who are led by the Head of Data Collection & Licensing. This team is responsible for ensuring all player data is up to date, while a community of over 6,000 FIFA Data Reviewers or Talent Scouts from all over the world are constantly providing suggestions and alterations to the database. 

In this project, our team will try to catch hold of several insights from the dataset using EDA and other statistical analysis methods. 

Sources
https://www.ea.com/games/fifa
https://www.fifplay.com/fifa-19-leagues-and-teams/
https://www.goal.com/en-ae/news/fifa-player-ratings-explained-how-are-the-card-number-stats/1hszd2fgr7wgf1n2b2yjdpgynu



## Chapter 2: Description of Data


### 2.1 Source Data

In this study, the CSV data file comes from FIFA 2019 database (https://www.kaggle.com/karangadiya/fifa19). This dataset contains 18,207 soccer player information in FIFA 2019 with 89 variables such as name, age, nationality, skill level, potential, club, transferred value, wage, preferred foot, body type, position in the field, height, and weight.	

```{r source data, include=F}
loadPkg("readr")
fifa <- read_csv("data.csv")
str(fifa)

```



### 2.2 Geographic Coverage of Data

To do a basic data visualization, latitude and longitude in the dataset are used to draw the map, which is plotted by leaflet library in R. 

#### The number of soccer players in each area of the world

```{r map1, include=F}
loadPkg("dplyr")
loadPkg("ggplot2")
loadPkg("maps")
overall_fifa <- fifa %>% 
  group_by(Nationality) %>% 
  summarise(Count = n(), 
            Avg_Overall = mean(Overall),
            Avg_Potential = mean(Potential),
            Avg_Pot_Diff = mean(Potential-Overall))
worldmap = map_data("world")
merged_fifa <- merge(x = worldmap, y = overall_fifa, by.x = "region", by.y = "Nationality", all.x = TRUE) %>% arrange(order)

```

```{r map1a, echo=FALSE, include=TRUE}
ggplot(data = merged_fifa, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = Count)) +
  labs(fill='Number of players')


```

#### The average skill level of soccer players in each area of the world (level: 0-100)

```{r map2, echo=FALSE, include=TRUE}
overall_fifa <- fifa %>% 
  group_by(Nationality) %>% 
  summarise(Count = n(), 
            Avg_Overall = mean(Overall),
            Avg_Potential = mean(Potential),
            Avg_Pot_Diff = mean(Potential-Overall)) %>%
  filter(Count > 45)
ggplot(data = merged_fifa, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = Avg_Overall)) +
  labs(fill='Average skill')


```



## Smart Question 1
#### How can we predict a dream team by determining the optimal skills(strength, heading, kick, jump) and vcharacteristics( leftfooted, bodytype, vision)in certain positions? And who would be the best players for the position?

## Player Positions, Values, and Skills 
#### Q1: How did the value of players vary according to the positions they play?

```{r, echo=F}
loadPkg("tidyverse")
loadPkg("ggplot2")
loadPkg("scales")
loadPkg("ggthemes")
```



```{r, echo=FALSE, include=TRUE}
fifa <- read.csv('data.csv')
fifa <- fifa %>%
  mutate(cleanvalue = ifelse(str_detect(Value, "K"), 1000, ifelse(str_detect(Value, "M"), 1000000, 1))) %>%
  mutate(value = as.numeric(str_extract(Value, "[[:digit:]]+\\.*[[:digit:]]*")) * cleanvalue)

playervalue <- fifa%>%
  ggplot(aes(x= value)) +
  geom_histogram(color = "white", fill = "darkgrey") +
  scale_x_continuous(labels = dollar_format(prefix = "€")) +
  ggtitle("Value of the Players") +
  theme_economist()

playervalue
```



```{r, echo=FALSE, include=TRUE}
playervalue <- fifa%>%
  ggplot(aes(y= value)) +
  geom_boxplot(outlier.colour="black", outlier.shape=16,
             outlier.size=2, notch=FALSE) +
  scale_y_log10(labels = dollar_format(prefix = "€")) +
  theme_economist()

playervalue
```


```{r, echo=F}
positions <- unique(fifa$Position)
midfielders <- c("LAM", "CAM", "RAM", "LM", "LCM", "CM", "RCM", "RM", "LDM", "CDM", "RDM")
strikers <- c("LS", "LW", "LF", "ST", "CF", "RF", "RS", "RW")
defenders <- c("LWB", "LB", "CB", "LCB", "RCB", "RB", "RWB")
fifa <- fifa %>% 
  mutate(PositionGroup = ifelse(Position %in% defenders, "Defenders", ifelse(Position %in% midfielders, "Midfielders", ifelse(Position %in% strikers, "Strikers", "Unknown"))))
```

```{r, echo=FALSE, include=TRUE}
PositionValue <- fifa %>%
  filter(PositionGroup != "Unknown") %>%
  ggplot(aes(x= PositionGroup, y= value)) +
  geom_boxplot(fill = "darkgrey") +
  scale_y_log10(labels = dollar_format(prefix = "€")) +
  ggtitle("Player's Value based on Positions", subtitle = "Strikers have more value than Midfielders and Defenders") +
  theme_economist()

PositionValue
```

#### Q2: What skills make strikers valuable?
```{r, echo=F}
fifastrikers <- fifa %>%
  filter(PositionGroup == "Strikers")
```

```{r, echo=F}
skills_names <- c("Crossing", "Finishing", "HeadingAccuracy", "ShortPassing", "Volleys", "Dribbling", "Curve", "FKAccuracy", "LongPassing", "BallControl", "Acceleration", "SprintSpeed", "Agility", "Reactions", "Balance", "ShotPower", "Jumping", "Stamina", "Strength", "LongShots", "Aggression", "Interceptions", "Positioning", "Vision", "Penalties", "Composure", "Marking", "StandingTackle", "SlidingTackle")
```

```{r, echo=F}
fifa_aplayers <- na.omit(fifastrikers[c("Position", skills_names, "Value")])
fifa_aplayers %>%
  gather(Skills, value, 2:30) %>%
  ggplot(aes(x=value, fill=Skills)) +
  geom_histogram(colour="black", show.legend=FALSE) +
  facet_wrap(~Skills, scales="free_x") +
  labs(x="Scores", y="Frequency",
       title="Skills - Histograms") +
  theme_bw()
```


```{r, echo=F}
fifa_aplayers %>%
  gather(Skills, values, 2:30) %>%
  ggplot(aes(x=reorder(Skills, values, FUN=median), y=values, fill=Skills)) +
  geom_boxplot(show.legend=FALSE) +
  labs(title="Skills - Boxplots") +
  theme_bw() +
  theme(axis.title.y=element_blank(),
        axis.title.x=element_blank()) +
  coord_flip()
```

```{r, echo=F}
loadPkg("corrplot")
corrplot(cor(fifa_aplayers[2:30]), type="upper", method="ellipse", tl.cex=0.9)
```


```{r, echo=F}
nfifa_skills <- as.data.frame(scale(fifa_aplayers[2:30]))
```

```{r, echo=F}
loadPkg("gridExtra")
bss <- numeric()
wss <- numeric()
set.seed(1234)
for(i in 1:10){
  bss[i] <- kmeans(nfifa_skills, centers=i)$betweenss
  wss[i] <- kmeans(nfifa_skills, centers=i)$tot.withinss
}
p1 <- qplot(1:10, bss, geom=c("point", "line"), 
            xlab="Number of clusters", ylab="Between-cluster sum of squares") +
  scale_x_continuous(breaks=seq(0, 10, 1)) +
  theme_bw()
p2 <- qplot(1:10, wss, geom=c("point", "line"),
            xlab="Number of clusters", ylab="Total within-cluster sum of squares") +
  scale_x_continuous(breaks=seq(0, 10, 1)) +
  theme_bw()
grid.arrange(p1, p2, ncol=2)
```


```{r, echo=F}
set.seed(1234)
nfifa_skills_k4 <- kmeans(nfifa_skills, centers=4)
str(nfifa_skills_k4)
```

```{r, include=F}
nfifa_skills_k4
```


```{r, echo=F}
loadPkg("factoextra")
fviz_cluster(nfifa_skills_k4, data = nfifa_skills)
```

```{r, echo=F}
loadPkg("GGally")
ggpairs(cbind(nfifa_skills, Cluster=as.factor(nfifa_skills_k4$cluster)),
        columns=1:6, aes(colour=Cluster, alpha=0.5),
        lower=list(continuous="points"),
        upper=list(continuous="blank"),
        axisLabels="none", switch="both") +
        theme_bw()
```


```{r, include=F}
mps.pr.out =prcomp(nfifa_skills, scale =TRUE)
summary(mps.pr.out)
mps.pr.out$rotation
```

```{r, echo=FALSE, include=TRUE}
biplot(mps.pr.out, scale = 0)
```


```{r, echo=FALSE, include=TRUE}
plot(mps.pr.out, type="l")
```

```{r, echo=F}
mps.pr.var <- (mps.pr.out$sdev^2)
mps.pve <- mps.pr.var/sum(mps.pr.var)
plot(cumsum(mps.pve), xlab="Principal Component (standardized)", ylab ="Cumulative Proportion of Variance Explained",ylim=c(0,1),type="b")
```


```{r, echo=FALSE}
loadPkg("FactoMineR")
loadPkg("factoextra")
```

```{r, echo=FALSE}
PCA(nfifa_skills, ncp = 4, graph = TRUE)
res.mp.pca <- PCA(nfifa_skills, graph = FALSE)
fviz_eig(res.mp.pca, addlabels = TRUE, ylim = c(0, 40))
```

```{r, echo=FALSE, include=TRUE}
fviz_pca_var(res.mp.pca, col.var = "contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             repel = TRUE
             )
```
```{r, echo=FALSE} 
var <- get_pca_var(res.mp.pca)
corrplot(var$contrib, is.corr=FALSE)
```
```{r}
fviz_contrib(res.mp.pca, choice = "var", axes = 1, top = 10)
fviz_contrib(res.mp.pca, choice = "var", axes = 2, top = 10)
fviz_contrib(res.mp.pca, choice = "var", axes = 3, top = 10)
fviz_contrib(res.mp.pca, choice = "var", axes = 4, top = 10)
```



## Smart Question 2
#### What variables contribute most to a player’s skill in penalty shots?
```{r S2, echo=FALSE, include=TRUE}

#Reload data
data <- read.csv("data.csv", check.names = FALSE, stringsAsFactors = FALSE)

#drop NAs
fifa <- na.omit(data)

#keep numeric variables only
fifa <- fifa[, !sapply(fifa, is.character)]

#drop ID variable
fifa <- fifa[, c(-1, -2)]
```
To begin the analysis, we drop all character variables and delete missing values. Additionally we drop the ID variable as it provides no usable information for our analysis. 


```{r EDA, echo=FALSE, include=TRUE}

barcolors = c("green", "violet", "orange", "blue", "pink", "red", "yellow", "cyan")

#subset data
fifacols <- c("Penalties", "Aggression","Age", "Stamina","ShotPower","Balance", "BallControl","LongPassing","HeadingAccuracy", "Strength")
fifa <- fifa[fifacols]

#histogram of Penalties
summary(fifa$Penalties)
sd(fifa$Penalties)
hist(fifa$Penalties, main="Histogram of Penalties", xlab="Skill in Penalties", ylab="Frequency", col=barcolors)

#summary correlation matrix
M <- cor(fifa)
M

#graphical correlation matrix
corrplot(M, method="circle")

```
The EDA process begins by subsetting the data set to include only variables of interest. We maintain Penalties are our dependent variable and include 9 explanatory variables. The summary statistics for Penalties indicate that players' penalties skill range from a low of 5.0 to a high of 92.0 with a mean of 49.0 and a stardard deviation of 15.7. The summary output of the correlation matrix suggest that most variables are correlated in some way to other variables. The graphical display of the correlation matrix visually confirms the correlations. The data may be appropriate for linear regression, but the high correlation associated with some variables may suggest multicollinearity.     
```{r linear, echo=FALSE, include=TRUE}

barcolors = c("green", "violet", "orange", "blue", "pink", "red", "yellow", "cyan")

#add linear reg, calculate mse
reg <- lm(Penalties ~ ., data=fifa)
summary(reg)
vif(reg)

reg.res <- resid(reg)
hist(reg.res, main="Histogram of Residuals", xlab="Residuals", ylab="Frequency", col=barcolors)

```
We build a multiple linear regression model where we regress Penalties on Aggression, Age, Stamina, ShotPower, Balance, BallControl, LongPassing, HeadingAccuracy and Strength. The coefficient on the intercept suggests that the mean skill value for players is 0.76, but the coefficient is not statistically significant at any level. However, setting the explanatory variables to zero and interpreting the intercept does not make sense. Age is an explanatory variable, and a zero value of age is not realistic. Additionally, the explanatory variables in the data set do not take on values of zero.  We suggest the insignificance of the intercept is OK.  The coefficients on all explanatory variables are statistically significant at the zero percent level, and suggest that all variables in the regression contribute to predicting a player's penalty skills. The VIF values for the explanatory variables suggest that there is no multicollinearity among the variables, but the variable BallControl is close to the multicollinearity threshhold of 10 with a value of 7.17.  The multiple regression model displays an R-squared value of 0.713, and suggests that the model explains 71 percent of the variance in the dependent variable. The histogram of the regression residuals suggest that the residuals are close to normally distributed. The multiple regression model is a good model that can accurately predict a player's skill in penalty shots. 

``` {r PCA, echo=FALSE, include=TRUE}

barcolors = c("green", "violet", "orange", "blue", "pink", "red", "yellow", "cyan")

#scale data
prscale <- prcomp(fifa, scale=TRUE)

#summary of scaled data
summary(prscale)

plot(prscale, main="PCA", type = "l", col=barcolors)
```
Although the multiple linear regression model performs well, we investigate the use of PCA/PCR to attempt to reduce the demensions of the model.  The output of the scaled data displays the principal components and their summary statistics.  4 principal components are enough to explain 85 percent of the variation in the data set while 6 principal components are enough to explain  93 percent.  The PCA graph displays a graphical representation of the proportion of variance explained by each principal component.  

```{r PCR, echo=FALSE, include=TRUE}
loadPkg("pls")

#PCR on training data using CV
smp_size <- floor(0.80 *nrow(fifa))
set.seed(2)
train_ind <- sample(seq_len(nrow(fifa)), size=smp_size)
fifa.train <- fifa[train_ind, ]
fifa.test <- fifa[-train_ind,]
y.test <- fifa.test[,1]
pcr.fit = pcr(Penalties ~., data=fifa.train, scale=TRUE, validation="CV")
summary(pcr.fit)

#plot validation
validationplot(pcr.fit, val.type="MSEP")

#calculate MSE
pcr.pred <- predict(pcr.fit, fifa.test, ncomp = 6)


#linear regression MSE
print("---------MSE Linear Regression---------")
mse <- mean(reg$residuals^2)
mse
print("---------MSE PCR ---------")
(mean((pcr.pred - y.test)^2))

#fit model
pcr.fit2 <- pcr(Penalties ~.,data=fifa, scale=TRUE, ncomp=6)
summary(pcr.fit2)

#show predicted values vs observed
predplot(pcr.fit2, main="Penalties Prediction Vs Penalties Observed")


```
We decide to build a PCA model and perform PCR. Ultimately, we would like to compare the MSE from the multiple linear regresson model to the MSE of the PCR model, and choose the model with the lower MSE. We split the data into training and testing data sets using and 80/20 split. We then fit the PCR model on the training dataset using 10-fold cross validation.  The output from the PCR fit of the training data set suggests that 6 principal components achieve the lowest RMSEP value at 8.502. The validation plot of the PCR graphically displays the RMSEP values of each principal component. We then compare the MSE from the linear regression model to the MSE of the PCR model. The MSE of the linear regression is higher (70.8) than the MSE of PCR (69.9). The PCR with 6 principal components performs well and displays a lower MSE then linear regression; therefore, we build a PCR model with 6 principal components and suggest that PCR is the better model.  










## Smart Question 3  
#### What variables contribute the most to a goalkeeper’s potential? Age, physical factors, current gk skills, etc... 

```{r, include=F}


loadPkg("readr")
loadPkg("stringr")
loadPkg("gsubfn")
loadPkg("car")

loadPkg("relaimpo")

```

#import data
```{r import}
data <- read_csv("data.csv")
#View(data)
str(data)
```

```{r weight height transform, include=F}


numextract <- function(string){str_extract(string, "\\-*\\d+\\.*\\d*")}

#Weight
data$Weight <- as.integer(numextract(data$Weight))

#Height

data$Height <- as.numeric(gsubfn("(\\d)'(\\d+)", ~ as.numeric(x) * 30.48 +
            as.numeric(y) * 2.54, sub('"', '', data$Height)))
data$Height <- as.integer(data$Height)
```



```{r gk}
gk<- subset(data,Position=="GK")
gk <- gk[,colSums(is.na(gk))<nrow(gk)]
gk
```

```{r normality check}


hist(gk$Potential,main="Histogram for goalkeepers' potential ratings", xlab="rating", col="orange")

qqnorm(gk$Potential, main = "GK's potential ratings Q-Q plot", ylab="rating quantiles", col=c("#ff0000","#00ff00","#0000ff","#ffff00"))
qqline(gk$Potential)

scatterplot(gk$Age, gk$Overall, col = "red", xlab = "Age", ylab = "Current Rating",main = "Age and Current Rating")

scatterplot(gk$Age, gk$Potential, col = "dark green", xlab = "Age", ylab = "Potential Rating",main = "Age and Potential Rating")
```

```{r model1, echo=FALSE}

fit1 <- lm(Potential ~ Age + Height + Weight + Reactions+ Jumping+ GKDiving + GKHandling + GKKicking + GKPositioning + GKReflexes , data = gk)
summary(fit1)
fit1
```


```{r model1b, echo=F, include=T}
plot(fit1, col=c("#ff0000","#00ff00","#0000ff","#ffff00"))
```

1. Residuals vs Fitted

Residuals vs Fitted: This plot shows if residuals have non-linear
patterns.

Equally spread residuals around a horizontal line without
distinct patterns -> does not show non-linear relationships ->
good.

2. Normal Q-Q

Normal Q-Q: This plot shows if residuals are normally distributed.

Residuals line quite well on the straight line -> normally
distributed.

3. Scale-Location

Scale-Location: This plot shows if residuals are spread equally along the
ranges of predictors -> check the assumption of equal variance
(homoscedasticity).

Horizontal line has equally (randomly) spread points -> good

4. Residuals vs Leverage

Residuals vs Leverage: This plot helps us find influential
outliers.

Outliers are not influential.

```{r relative importance}
# Calculate Relative Importance for Each Predictor

calc.relimp(fit1, type = c("lmg"), rela=TRUE)

# Bootstrap Measures of Relative Importance (1000 samples)
boot <- boot.relimp(fit1, b = 1000, rank = TRUE,
  diff = TRUE, rela = TRUE)
plot(booteval.relimp(boot,sort=TRUE)) # plot result

```










## Smart Question 4 
#### How do specific Skill Sets/ Characteristics affect a players wage? How about value? Can we say Skills are a good predictor of Wage and value?

```{r r, echo=FALSE, include=TRUE}
## reading data
data <- read.csv("data.csv", check.names = FALSE, stringsAsFactors = FALSE)
```

```{r S44, echo=FALSE, include=TRUE}

## naming rows
wage_skills <- c("Wage","Crossing", "Finishing", "HeadingAccuracy", "ShortPassing", "Volleys", "Dribbling", "Curve", "FKAccuracy", "LongPassing", "BallControl", "Acceleration", "SprintSpeed", "Agility", "Reactions", "Balance", "ShotPower", "Jumping", "Stamina", "Strength", "LongShots", "Aggression", "Interceptions", "Positioning", "Vision", "Penalties", "Composure", "Marking", "StandingTackle", "SlidingTackle", "GKDiving", "GKHandling", "GKKicking", "GKPositioning", "GKReflexes")


value_skills <- c("Value", "Crossing", "Finishing", "HeadingAccuracy", "ShortPassing", "Volleys", "Dribbling", "Curve", "FKAccuracy", "LongPassing", "BallControl", "Acceleration", "SprintSpeed", "Agility", "Reactions", "Balance", "ShotPower", "Jumping", "Stamina", "Strength", "LongShots", "Aggression", "Interceptions", "Positioning", "Vision", "Penalties", "Composure", "Marking", "StandingTackle", "SlidingTackle", "GKDiving", "GKHandling", "GKKicking", "GKPositioning", "GKReflexes")

wage_value <- c("Value","Wage")


```

First, we cleaned up and formetted the Wage and Value column by first removing the pound(€) sign. We then wanted to remove the non-numerical characters in the data "M", "K", and ".". To keep the data meaningful, we created a column for M and a column for K for both Wage and Value and copied ththem in their respective columns before removing the characters. The only thing left is numbers and periods. we then multiplied the M column with 1,000,000 and K column with 1,000. After this, We merged them into their respective Wage and Value columns now formatted as numericalv values ready for operations and functions. We cahnged the skill int values to numeric and we also omitted NA values just incase there are some.

```{r S4a, echo=FALSE, include=TRUE}
####CLEAN DATA (Wage and Value having same range. remove M and K and period)

#clean data (Removing Pound Sign)
loadPkg('stringr')
data_wage_skills <- na.omit(data[c(wage_skills)])
data_value_skills <- na.omit(data[c(value_skills)])

data_wage_skills$Wage <- str_replace(
    data_wage_skills$Wage, # column we want to search
    pattern = '[€]', # what to find
    replacement = '' # what to replace it with
)
data_value_skills$Value <- str_replace(
    data_value_skills$Value, # column we want to search
    pattern = '[€]', # what to find
    replacement = '' # what to replace it with
)
```

```{r S4b, echo=FALSE, include=TRUE}
####Start of Wage Cleanup

data_wage_skills$WageM <- str_replace(
    data_wage_skills$Wage, # column we want to search
    pattern = 'M', # what to find
    replacement = '' # what to replace it with
)
data_wage_skills$WageK <- str_replace(
    data_wage_skills$Wage, # column we want to search
    pattern = 'K', # what to find
    replacement = '' # what to replace it with
)

data_wage_skills$WageMM <- rep(0, length(data_wage_skills$WageM))
data_wage_skills$WageKK <- rep(0, length(data_wage_skills$WageK))

non_alphaM <-grep("[[:alpha:]]",data_wage_skills$WageM, invert = TRUE)
data_wage_skills$WageMM[non_alphaM] <- data_wage_skills$WageM[non_alphaM]

non_alphaK <-grep("[[:alpha:]]",data_wage_skills$WageK, invert = TRUE)
data_wage_skills$WageKK[non_alphaK] <- data_wage_skills$WageK[non_alphaK]

data_wage_skills$WageMM <- as.numeric(data_wage_skills$WageMM)*1000000
data_wage_skills$WageKK <- as.numeric(data_wage_skills$WageKK)*1000

data_wage_skills$Wage <- data_wage_skills$WageMM + data_wage_skills$WageKK


#### End of Wage CLeanup
```

```{r S4c, echo=FALSE, include=TRUE}
#### Start of ValueCleanup

data_value_skills$ValueM <- str_replace(
    data_value_skills$Value, # column we want to search
    pattern = 'M', # what to find
    replacement = '' # what to replace it with
)
data_value_skills$ValueK <- str_replace(
    data_value_skills$Value, # column we want to search
    pattern = 'K', # what to find
    replacement = '' # what to replace it with
)

data_value_skills$ValueMM <- rep(0, length(data_value_skills$ValueM))
data_value_skills$ValueKK <- rep(0, length(data_value_skills$ValueK))

non_alphaVM <-grep("[[:alpha:]]",data_value_skills$ValueM, invert = TRUE)
data_value_skills$ValueMM[non_alphaVM] <- data_value_skills$ValueM[non_alphaVM]

non_alphaVK <-grep("[[:alpha:]]",data_value_skills$ValueK, invert = TRUE)
data_value_skills$ValueKK[non_alphaVK] <- data_value_skills$ValueK[non_alphaVK]

data_value_skills$ValueMM <- as.numeric(data_value_skills$ValueMM)*1000000
data_value_skills$ValueKK <- as.numeric(data_value_skills$ValueKK)*1000

data_value_skills$Value <- data_value_skills$ValueMM + data_value_skills$ValueKK

#### End of Value Cleanup
```

```{r S4d, echo=FALSE, include=FALSE}
#More cleanup and formatting 
data_wage_skills <- na.omit(data_wage_skills[c(wage_skills)])
data_value_skills <- na.omit(data_value_skills[c(value_skills)])
data_wage_skills[2:35] <- lapply(data_wage_skills[2:35], as.numeric)
data_value_skills[2:35] <- lapply(data_value_skills[2:35], as.numeric)

wage_value$Wage <- data_wage_skills$Wage
wage_value$Value <- data_value_skills$Value

# take log individually
data_wage_skills$Wage < - log(data_wage_skills$Wage)
data_value_skills$Value < - log(data_value_skills$Value)
wage_value$Wage <-log(wage_value$Wage)
wage_value$Value <- log(wage_value$Value)

data_wage_skills$Wage < - log(data_wage_skills$Wage)
data_value_skills$Value < - log(data_value_skills$Value)
wage_value$Wage <-log(wage_value$Wage)
wage_value$Value <- log(wage_value$Value)


```


#### Structure of the Datasets
``` {r structure1, echo=FALSE, include=TRUE}
# # remove outliers
# outlierKD(data_value_skills, Value, 'y')
# summary(data_value_skills$Value)
# 
# outlierKD(data_wage_skills, Wage, 'y')
# summary(data_wage_skills$Wage)
# 
# outlierKD(wage_value, Wage, 'y')
# summary(wage_value$Wage)
# outlierKD(wage_value, Value, 'y')
# summary(wage_value$Value)

str(data_wage_skills)
str(data_value_skills)
```

#### HISTOGRAM
We transformed the Wage and Value because they were heavily skewed to the right. After the log transformation, the historgam looks a little more normal. For Wage however, although it is better, is still right skewed. We tried using Tukey transformation which is stronger than log() but it was only limited to about 5,000 observations. We have morethan 1 million observations. This is one of our limitations.
```{r S4ee, echo=FALSE, include=TRUE}
hist(wage_value$Wage, xlab = "Wage", main = "Histogram of Wage", col="cornsilk3")
hist(wage_value$Value, xlab = "Value", main = "Histogram of Value", col = "cornsilk2")

#qqnorm(wage_value$Wage, main = "Wage Q-Q plot")
#qqline(wage_value$Wage, col = "red")

#qqnorm(wage_value$Value, main = "Value Q-Q plot")
#qqline(wage_value$Value, col = "blue")
```

### 4.1 Multiple Regression
To answer the question, we performed multiple regressions for Wage and Value with Skills and have the results shown below. We showed the top 5 skills that explain Wage and Value.

#### Wage-Skills
```{r S4e, echo=FALSE, include=TRUE}
wage_lm <- lm(Wage ~ ., data = data_wage_skills)
summary(wage_lm)
```
Top 5 Skills that Explain Wage:
Reactions    - 682.6, 
Composure    - 212.4, 
Ball Control - 209.5, 
GK Handling  - 176.8, 
GK Diving    - 174.0

#### Value-Skills
```{r S4f, echo=FALSE, include=TRUE}
value_lm <- lm(Value ~ ., data = data_value_skills)
summary(value_lm)
```
Top 5 Skills that Explain Value:
Reactions     - 208049, 
Short Passing - 56542, 
Composure     - 53780, 
Ball Control  - 52684, 
GK Diving     - 44531

#### Result and Findings from the Multiple Regression
What is interesting is the skills that affect value and wage the most are reactions, composure, ball control and GK diving. all these made top 5 skills that explain wage and value. These skills are the best predictors of wage and value. We can see however that other than these four skills, GK handling seems to explain wage and Short passing seems to explain a Players value.

### 4.2 Analysis of the Models
We analysed the models to see if it holds with the models assumptions. We plotted the residuals and  looked at the VIF values.

#### Wage Plot of the Residuals
```{r S4plotw, echo=FALSE, include=TRUE}
#### PLOT OF RESIDUALS
#Wage residuals
plot(wage_lm)
```

#### Value Plot of the Residuals
```{r S4plotv, echo=FALSE, include=TRUE}
#Wage residuals
plot(value_lm)
```

#### Findings from the Plots
We reviewed the plots and both Wage and value have similar results. These are our observations:

Residual vs fitted - What we want is a linear pattern and we dont want non linear patterns. It seems like in this case even if it is curved the pattern is quite linear considering we have a huge dataset (its okay)

QQ plot - What we want here is the residual points not deviating so much from the line. In this case, they deviate off the line severely (not good)

Scale location - We want residuals randomly spread throughout the line. In this case residuals not spread randomly spread, and appears that it is concentrated in the left and starts to spread out on the right (not good)

Residual vs Leverage - we want residuals to be inside Cooks Distance or the dashed line. In this case, we cannot see the dashed line. We are not sure if it is inside or outside the dashed line.


#### Wage VIF
```{r S4g, echo=FALSE, include=TRUE}
#### VIFs and HISTOGRAM OF RESIDUALS
#Wage VIF
vif(wage_lm)
```

#### Value VIF
```{r S4gg, echo=FALSE, include=TRUE}
vif(value_lm)
```

#### MULTICOLLINEARITY
It seems like we have multicollinearity since our VIFs are way greater than 5. The independent variables are too correlated with each other and these Values Suggest that they are poorly estimated.


```{r S4i, echo=FALSE, include=TRUE}
#boxplot(wage_value)
#plot(wage_value$Wage, wage_value$Value, xlab = "Wage", ylab = "Value")

```

```{r s4j, echo=FALSE, include=TRUE}
loadPkg("corrplot")
## corrplot 0.84 loaded
#M <- cor(wage_value$Wage,wage_value$Value)
#corrplot.mixed(M, method = "circle")
#resid(wage_lm)
#resid(value_lm)

```

```{r S4k, echo=FALSE, include=TRUE}
#PCA_wage_skills_C <- prcomp(data_wage_skills, center = TRUE,scale. = TRUE) #center
#PCA_wage_skills_R <- prcomp(data_wage_skills, center = TRUE,scale. = FALSE) #raw
#summary(PCA_wage_skills_C)
#summary(PCA_wage_skills_R)
```

```{r S4l, echo=FALSE, include=TRUE}
#PCA_value_skills_C <- prcomp(data_value_skills, center = TRUE,scale. = TRUE) #center
#PCA_value_skills_R <- prcomp(data_value_skills, center = TRUE,scale. = FALSE) #raw
#summary(PCA_value_skills_C)
#summary(PCA_value_skills_R)
```



## Smart Question 5 
#### How do physical factors (age, preferred foot, overall skill, international reputation, position in the field, weight, and height) help the soccer professionals to get wage for higher 100,000 Euro per week?
```{r S5, echo=FALSE, include=TRUE}
#Wage(Factor) – 1 (Higher 100k euro per week), 0 (lower 100k euro per week).
#Age (Integer)
#Foot (Factor)
#Skill (Integer)
#Weight (Integer)
#Height (Integer)
#International reputation (Factor) – 5 level.
#Position (Factor) – 4 types, including Goalkeeper, defense, midfield, and attack.
#=======
## Chapter 7: Earning higher 100,000 Euro per week of soccer players (Jay)

### 7.1 SMART Question
#### How do physical factors help the soccer professionals to get wage for higher 100,000 Euro per week?
```

```{r import fifa, include=F}
#import data
fifaOri <- read.csv("data.csv")
#fifaOri <- select(Dataa, Age, Overall, Wage, Preferred.Foot, Position, Height, Weight)

```

### 7.2 Exploratory Data Analysis
In this section, we perform the exloratory data analysis (EDA) on several numerical variables in the dataset. After assessing some of the characteristics of those variables, we decided to clean the data by omitting outliers and NA values. 

#### 7.2.1. Data tranformation and Descriptive Statistics
##### Data tranformation 
In this chapter, we use logistic regression with 7 variables including age, skill level, wage, preferred foot, position, height, and weight. However, we have not cleaned the data yet.

The original data are below:

```{r EDA11, echo=F}
str(fifaOri)

```

```{r clean data, include=F}
#clean data
#wage
loadPkg("stringr")
numextract <- function(string){ 
  str_extract(string, "\\-*\\d+\\.*\\d*")
} 
fifaOri$Wage <- as.integer(numextract(fifaOri$Wage))
fifaOri$Wage_dummy <- as.factor(ifelse(fifaOri$Wage > 99, 1, 0))
#Foot - cleaned
y <- as.factor(fifaOri$Preferred.Foot)
levels(y) <- list(Left  = c("Left"), 
                  Right = c("Right"))
fifaOri <- mutate(fifaOri, Preferred.Foot = y)
#age - cleaned
#skill - cleaned
#Weight
fifaOri$Weight <- as.integer(numextract(fifaOri$Weight))
#Height 

loadPkg("gsubfn")

fifaOri$Height <- as.numeric(gsubfn("(\\d)'(\\d+)", ~ as.numeric(x) * 30.48 + 
            as.numeric(y) * 2.54, sub('"', '', fifaOri$Height)))
fifaOri$Height <- as.integer(fifaOri$Height)
#position
x <- as.factor(fifaOri$Position)
levels(x) <- list(GK  = c("GK"), 
                  DEF = c("LWB", "LB", "CB", "RB", "RWB", "LCB", "RCB"), 
                  MID = c("CM", "LDM", "LAM", "RDM", "RAM", "CDM", "CAM", "LM", "RM", "LCM", "RCM"), 
                  FWD = c("CF", "ST", "LW", "RW", "LF", "RF", "LS", "RS"))
fifaOri <- mutate(fifaOri, Position = x)
#Region 
#library(countrycode)
#fifa$Nationality <- as.factor(fifa$Nationality)
#fifa$region <- as.factor(countrycode(sourcevar = fifa[, "Nationality"],
                          #  origin = "country.name",
                           # destination = "continent"))
#fifa <- mutate(fifa, Position = x)

str(fifaOri)
head(fifaOri)


```

After transforming some variables, we got the new data. There are 4 numeric variables (age, skill level, height, and weight) and 3 categorical variables (Wage_dummy, position, and preferred foot)    

The new data are below:

```{r EDA1, echo=F}
fifaQQ <- fifaOri
str(fifaQQ)

```

##### Descriptive Statistics

The descriptive statistics are presented below:

```{r EDA2, echo=F}
summary(fifaQQ)

```

According to the above statistics, it can be seen that mean and median of 4 numeric variables are very close. However, There are a lot of missing values (NAs) in height, weight, position, and preferred foot.

#### 7.2.2. Normality (Q-Q plots)

In this step, we need to check normality for 4 numeric variable, including age, skill level, height, and weight. 

```{r EDA3, echo=F}
par(mfrow=c(2,2))
qqnorm(fifaQQ$Age, main = "Age Q-Q plot", ylab="Age quantiles")
qqline(fifaQQ$Age, col = "red")
qqnorm(fifaQQ$Overall, main = "Skill level Q-Q plot", ylab="Skill level quantiles")
qqline(fifaQQ$Overall, col = "red")
qqnorm(fifaQQ$Height, main = "Height Q-Q plot", ylab="Height quantiles")
qqline(fifaQQ$Height, col = "red")
qqnorm(fifaQQ$Weight, main = "Weight Q-Q plot", ylab="Weight quantiles")
qqline(fifaQQ$Weight, col = "red")

```

According to the above Q-Q plots, these four numeric variables are not far from normal distribution. However, the tails in each Q-Q plot indicate that the data have the outliers. Therefore, removing outliers process is required before doing an analysis in the next step.

```{r out, include=F}
#Create a function to eliminate outliners.
outlierKD <- function(dt, var, rmv=NULL) { 
     var_name <- eval(substitute(var),eval(dt))
     na1 <- sum(is.na(var_name))
     m1 <- mean(var_name, na.rm = T)
     sd1 <- sd(var_name,na.rm = T)
     par(mfrow=c(2, 2), oma=c(0,0,3,0))
     boxplot(var_name, main="With outliers")
     hist(var_name, main="With outliers", xlab=NA, ylab=NA)
     outlier <- boxplot.stats(var_name)$out
     mo <- mean(outlier)
     var_name <- ifelse(var_name %in% outlier, NA, var_name)
     boxplot(var_name, main="Without outliers")
     hist(var_name, main="Without outliers", xlab=NA, ylab=NA)
     title("Outlier Check", outer=TRUE)
     na2 <- sum(is.na(var_name))
     cat("Outliers identified:", na2 - na1, "n")
     cat("Propotion (%) of outliers:", round((na2 - na1) / sum(!is.na(var_name))*100, 1), "n")
     cat("Mean of the outliers:", round(mo, 2), "n")
     m2 <- mean(var_name, na.rm = T)
     cat("Mean without removing outliers:", round(m1, 2), "n")
     cat("Mean if we remove outliers:", round(m2, 2), "n")
     #
     if(is.null(rmv)) { 
       response <- readline(prompt="Do you want to remove outliers and to replace with NA? [yes/no]: ") 
     } else {
       if (rmv=='y'|rmv=='yes'|rmv=='Y'|rmv=='Yes'|rmv=='YES'|rmv==TRUE ) { response = 'y' } else { response = 'n' }
     }
     #
     if(response == "y" | response == "yes"){
          dt[as.character(substitute(var))] <- invisible(var_name)
          assign(as.character(as.list(match.call())$dt), dt, envir = .GlobalEnv)
          cat("Outliers successfully removed", "n")
          return(invisible(dt))
     } else{
          cat("Nothing changed", "n")
          return(invisible(var_name))
     }
}
```

```{r out2, include=F}
outlierKD(fifaQQ, Age,'y') #Eliminate outliers.
outlierKD(fifaQQ, Overall,'y') #Eliminate outliers.
outlierKD(fifaQQ, Weight,'y') #Eliminate outliers.
outlierKD(fifaQQ, Height,'y') #Eliminate outliers.
fifaNew <- na.omit(fifaQQ) #Eliminate NAs
summary(fifaNew) #Check the summary statistics of fifa
str(fifaNew)

```

### 7.3 Pre-Logistic Regression

#### Does the data support that “Age”, "Preferred foot", "Overall skill level", "Preferred position", "Weight", and "Height" affect “Wage”?

#### 7.3.1 Age VS Wage

To study the effects on wage by the age (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.1, include=F}
wageagetable = xtabs(~ Wage_dummy + Age, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.1a, echo=FALSE, include=TRUE}
chisqres_Q1 = chisq.test(wageagetable)
chisqres_Q1

```

From the small p-value of `r chisqres_Q1$p.value`, we reject the null hypothesis that the "Wage" and  "Age" are independent. Therefore, the data supports “age” may have an effect on “Wage”. 

#### 7.3.2 Preferred foot VS Wage

To study the effects on wage by preferred foot (both of them categorical variables), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.2, include=F}
wagefoottable = xtabs(~ Wage_dummy + Preferred.Foot, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.2a, echo=FALSE, include=TRUE}
chisqres_Q2 = chisq.test(wagefoottable)
chisqres_Q2

```

From the large p-value of `r chisqres_Q2$p.value`, we fall to reject the null hypothesis that the "Wage" and  "Foot" are independent. Therefore, the data supports “Prefered foot” might not have an effect on “Wage”. 

##### 7.3.3 Wage VS Overall skill level

To study the effects on wage by the skill level (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.3, include=F}
wageskilltable = xtabs(~ Wage_dummy + Overall, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.3a, echo=FALSE, include=TRUE}
chisqres_Q3 = chisq.test(wageskilltable)
chisqres_Q3

```

From the small p-value of `r chisqres_Q3$p.value`, we reject the null hypothesis that the "Wage" and  "Skill level" are independent. Therefore, the data supports “Skill level” might have an effect on “Wage”.

##### 7.3.4 Wage VS Height

To study the effects on wage by the height (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.  

```{r 4.3.4, include=F}
wageheitable = xtabs(~ Wage_dummy + Height, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.4a, echo=FALSE, include=TRUE}
chisqres_Q4 = chisq.test(wageheitable)
chisqres_Q4

```

From the large p-value of `r chisqres_Q4$p.value`, we fall to reject the null hypothesis that the "Wage" and  "Height" are independent. Therefore, the data supports “Height” might not have an effect on “Wage”.


#### 7.3.5 Wage VS Weight

To study the effects on wage by the weight (one categorical variable and one qualitative variable, respectively), we can create two-way contingency table of the outcome and predictors.  

```{r 4.3.5, include=F}
wageweitable = xtabs(~ Wage_dummy + Weight, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.5a, echo=FALSE, include=TRUE}
chisqres_Q5 = chisq.test(wageweitable)
chisqres_Q5

```

From the large p-value of `r chisqres_Q5$p.value`, we fall to reject the null hypothesis that the "Wage" and  "weight" are independent. Therefore, the data supports “Weight” might not have an effect on “Wage”.

#### 7.3.6 Wage VS Perferred position in the field

To study the effects on wage by the position (two categorical variables), we can create two-way contingency table of the outcome and predictors.

```{r 4.3.6, echo=FALSE, include=TRUE}
wagepositable = xtabs(~ Wage_dummy + Position, data = fifaNew)

```

##### Chi squared test

We can then quickly run a chi-squared test to see if the two are independent (or same frequency distribution).

```{r 4.3.6a, echo=FALSE, include=TRUE}
chisqres_Q6 = chisq.test(wagepositable)
chisqres_Q6
#>>>>>>> c62f819f41a0539212ee1fa7fe260fdac0397553

```

From the small p-value of `r chisqres_Q6$p.value`, we reject the null hypothesis that the "Wage" and  "Position" are independent at the 1% significance level. Therefore, the data supports “Position” might have an effect on “Wage”.

### 7.4 Logistic Regression

Let us now turn our attention to logistic regression models. We run the Wage model including age, preferred.Foot, overall skill level, preferred position in the field, weight, and height.

```{r 4.4, include=F}
wageLogit <- glm(Wage_dummy ~ Age + Preferred.Foot + Overall + Position + Weight + Height , data = fifaNew, family = "binomial")

```

#### We can see the summary of the logistic regression model here:  
```{r 4.4a, echo=FALSE, include=TRUE}
summary(wageLogit)
```
#### Model interpretation: 

##### The age effect on wage
According to the above regression results, the cofficient on age indicates that for every one year increases in age, ln(odds-ratio) of wage at higher 100,000 Euro per week level decreases by 0.06. In other word, it means that the young player have more opportunity to earn higher 100k Euro per week than the olders. Furthermore, it is statistically significant.

##### The preferred foot effect on wage
For preferred foot: use left foot as baseline, ln(odds-ratio) of wage at higher 100,000 Euro per week level deceases by 0.02 when changing from left to right foot. So, it is likely that the left foot players have more the opportunity to earn higher 100,000 Euro per week than the right foot player. However, it is not statistically significant. 

##### The skill level effect on wage
The cofficient on skill level indicates that for every one level increases in overall skill, ln(odds-ratio) of wage at higher 100,000 Euro per week level increase by 0.72. In other word, it means that the high skill players have more opportunity to earn higher 100k Euro per week than the low skill players. In addition, it is statistically significant.

##### The effect of position of the player in the field on wage 
For position: use Goalkeeper as baseline, ln(odds-ratio) of wage at higher 100,000 Euro per week level increases by 1.42 when changing from Goalkeeper to Defender. And, ln(odds-ratio) of higher 100,000 euro wage increases by 1.35 when changing from Goalkeeper to Midfielder. Finally, ln(odds-ratio) of higher 100,000 euro wage increases by 1.49 when changing from Goalkeeper to Forward. It is likely that the opportunity to earn higher 100k Euro per week will increase if the preferred position of soccer players are far from goalkeeper. In addition, the case is statistically significant. 

##### The weight effect on wage
The cofficient on weight indicates that for every one lbs increases in weight, ln(odds-ratio) of wage at higher 100,000 Euro per week level decreases by 0.006. In other word, it means that the low weight players have more opportunity to earn higher 100k Euro per week than the high weight players. However, this case is not statistically significant.

##### The height effect on wage
The cofficient on height indicates that for every one centimeter (CM) increases in height, ln(odds-ratio) of wage at higher 100,000 Euro per week level decreases by 0.002. In other word, it seems that the short players have more opportunity to earn higher 100k Euro per week than the tall players height. However, it is not statistically significant.

### 7.5 Model evaluation

#### 7.5.1. ROC curve and AUC
Receiver-Operator-Characteristic (ROC) curve and Area-Under-Curve (AUC) measures the true positive rate (or sensitivity) against the false positive rate (or specificity). The area-under-curve is always between 0.5 and 1. Values higher than 0.8 is considered good model fit.  

```{r 4.5.1, include=F}
loadPkg("pROC") # receiver operating characteristic curve, gives the diagnostic ability of a binary classifier system as its discrimination threshold is varied. The curve is on sensitivity/recall/true-positive-rate vs false_alarm/false-positive-rate/fall-out.
prob=predict(wageLogit, type = c("response"))
fifaNew$prob=prob
h <- roc(Wage_dummy~prob, data=fifaNew)
auc(h) # area-under-curve prefer 0.8 or higher.

```

The result is shown here: 

```{r 4.5.1a, echo=FALSE, include=TRUE}
plot(h)
# detach("package:pROC", unload = T) # good habit to remove unload packages no longer needed 
```

We have here the area-under-curve of `r auc(h)`, which is higher than 0.8. This indicates the model is really a good fit, and all the coefficients are significant.  

#### 7.5.2. McFadden  
McFadden is another evaluation tool we can use on logitistic regressions. This is part of what is called pseudo-R-squared values for evaluation tests.

```{r 4.5.2, include=F}
loadPkg("pscl") # use pR2( ) function to calculate McFadden statistics for model eval
wageLogitpr2 = pR2(wageLogit)
wageLogitpr2
# detach("package:pscl", unload = T) # good habit to remove unload packages no longer needed 
```

In this case, the McFadden value is `r wageLogitpr2['McFadden']`, which is analgous to the coefficient of determination R$2$, only about 5.7% of the variations in y is explained by the explanatory variables in the model. 

